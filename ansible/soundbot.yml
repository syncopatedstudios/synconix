---

# - name: get a list of installed packages
#   import_playbook: installed_packages.yml
#   tags: ['packages']

- hosts: all
  gather_facts: yes
  tags: ['butt']
  vars:
    env_vars:
      ZSH: "{{ user.zsh }}"
      PATH: "{{ ansible_env.PATH }}:{{ path|join(':') }}"

  pre_tasks:
    - name: check whether this is an initial install
      stat:
        path: "{{ user.home }}/.installed"
      register: installed

    - set_fact:
        _installed: "{{ installed }}"

  tasks:
    - name: touch installed
      shell: |
        touch .installed
      args:
        chdir: "{{ user.home }}"

    - name: Reboot on initial setup
      shell: "shutdown -r now"
      when: installed.changed

  roles:
     - { role: distro, tags: ['distro'] }
     - { role: common, tags: ['common'] }
     - { role: networking, tags: ['networking'] }
     - { role: ui, tags: ['ui'] }
     - { role: devel, tags: ['devel'] }
     - { role: audio, tags: ['builds'] }
     - { role: soundbot, tags: ['soundbot'] }

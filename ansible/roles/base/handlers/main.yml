---

- name: reload firewalld
  shell: "firewall-cmd --reload"

- name: restart libvirtd
  action: service name=libvirtd state=restarted

- name: restart systemd-networkd
  become: true
  service:
    name: systemd-networkd
    state: restarted
    enabled: yes
  when: systemd_networkd_apply_config

- name: rtirq service
  systemd:
    name: rtirq
    state: restarted
    enabled: yes

- name: rtkit service
  systemd:
    name: rtkit-daemon
    state: restarted
    enabled: yes
    daemon_reload: yes

- name: autofs service
  systemd: enabled=yes state=restarted daemon_reload=yes name=autofs

- name: docker service
  systemd:
    name: docker
    state: restarted
    enabled: yes

- name: libvirtd service
  service:
    name: libvirtd
    enabled: no
    state: stopped

- name: reload user systemd
  systemd:
    daemon_reload: yes
  become: True
  become_user: "{{ user.name }}"

- name: reload systemd
  systemd:
    daemon_reload: yes

- name: update desktop database
  command: bash -lc "update-desktop-database"

- name: restart i3
  command: bash -lc "i3-msg -s /run/user/{{ user.uid }}/i3/ipc-socket.* restart"
  become: True
  become_user: "{{ user.name }}"
  ignore_errors: True

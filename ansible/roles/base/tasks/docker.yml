---

- name: Add user to docker group
  user:
    name: "{{ user.name }}"
    groups: "docker"
    append: yes
  tags: ['docker']

- name: push docker service config
  template:
    src: usr/lib/systemd/docker.service.j2
    dest: /usr/lib/systemd/docker.service
    owner: root
    group: root
    mode: '644'
    backup: yes
  register: docker_service
  notify:
    - "reload systemd"
    - "docker service"

- name: reload systemd
  shell: |
    systemctl daemon-reload
  when: docker_service.changed
  tags: ['docker']

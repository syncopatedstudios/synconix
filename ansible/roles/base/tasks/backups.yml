---

- name: install exclude list for home dir
  template:
    src: "dots/exclude.list.j2"
    dest: "{{ user.home }}/.exclude.list"
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
  become: True
  become_user: "{{ user.name }}"

- name: create Studio directory
  shell: |
    mkdir -pv {{ user.home }}/Studio
  become: True
  become_user: "{{ user.name }}"

- name: install Studio include list
  copy:
    src: dots/Studio/.exclude.list
    dest: "{{ user.home }}/Studio/.exclude.list"
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: '0644'

- name: install osync configs
  template:
    src: "etc/osync/{{ item }}.j2"
    dest: "/etc/osync/{{ item }}"
    owner: root
    group: root
    mode: '0644'
  with_items:
    - sync_home.conf
    - sync_studio.conf

# - block:
#     - name: ensure lsyncd config dir exists
#       file:
#         path: "{{ user.home }}/.config/lsyncd"
#         state: directory
#         owner: "{{ user.name }}"
#         group: "{{ user.name }}"
#
#     - name: install lsyncd config
#       template:
#         src: "dots/config/lsyncd/lsyncd_home.conf.lua.j2"
#         dest: "{{ user.home }}/.config/lsyncd/lsyncd_home.conf.lua"
#         owner: "{{ user.name }}"
#         group: "{{ user.name }}"
#
#     - name: install lsyncd systemd config
#       template:
#         src: usr/lib/systemd/system/lsyncd.service.j2
#         dest: /usr/lib/systemd/system/lsyncd.service
#         owner: root
#         group: root
#       register: lsyncd_service
#
#     - name: reload systemd
#       shell: |
#         systemctl daemon-reload
#       when: lsyncd_service.changed
#
#     - name: enable lsyncd service
#       systemd:
#         name: lsyncd
#         state: stopped
#         enabled: no
#   tags: ['lsyncd']

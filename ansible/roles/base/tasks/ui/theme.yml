---

- name: Update icon path for DragonflyReverb
  lineinfile:
    path: "/usr/share/applications/{{ item }}"
    regexp: "^Icon="
    line: Icon=dragonfly
  with_items:
    - "io.github.michaelwillis.DragonflyEarlyReflections.desktop"
    - "io.github.michaelwillis.DragonflyHallReverb.desktop"
    - "io.github.michaelwillis.DragonflyPlateReverb.desktop"
    - "io.github.michaelwillis.DragonflyRoomReverb.desktop"
  tags: ['icons']

- name: Update icon path for ZamPlugins
  lineinfile:
    path: "/usr/share/applications/{{ item }}"
    regexp: "^Icon="
    line: Icon=zam
  with_items:
    - "com.zamaudio.zamautosat.desktop"
    - "com.zamaudio.zamaximx2.desktop"
    - "com.zamaudio.zamcomp.desktop"
    - "com.zamaudio.zamcompx2.desktop"
    - "com.zamaudio.zamdelay.desktop"
    - "com.zamaudio.zamdynamiceq.desktop"
    - "com.zamaudio.zameq2.desktop"
    - "com.zamaudio.zamgate.desktop"
    - "com.zamaudio.zamgatex2.desktop"
    - "com.zamaudio.zamgeq31.desktop"
    - "com.zamaudio.zamgrains.desktop"
    - "com.zamaudio.zamheadx2.desktop"
    - "com.zamaudio.zammulticompx2.desktop"
    - "com.zamaudio.zamphono.desktop"
    - "com.zamaudio.zamtube.desktop"
    - "com.zamaudio.zamulticomp.desktop"
    - "com.zamaudio.zamverb.desktop"
  tags: ['icons']

- name: Update icon path for Zita
  lineinfile:
    path: "/usr/share/applications/{{ item }}"
    regexp: "^Icon="
    line: Icon=redzita
  with_items:
    - "zita-mu1.desktop"
    - "zita-rev1.desktop"
  tags: ['icons']

- name: Set japa to use Jack
  lineinfile:
    path: "/usr/share/applications/japa.desktop"
    regexp: "^Exec="
    line: Exec=japa -J
  tags: ['icons']

- name: Set icon for ams
  lineinfile:
    path: "/usr/share/applications/ams.desktop"
    regexp: "^Icon="
    line: Icon=ams_32
  tags: ['icons']

- name: Set icon for jack-rack
  lineinfile:
    path: "/usr/share/applications/jack-rack.desktop"
    regexp: "^Icon="
    line: Icon=jack-rack-icon
  tags: ['icons']

- name: Set icon for jamin
  lineinfile:
    path: "/usr/share/applications/jamin.desktop"
    regexp: "^Icon="
    line: Icon=jamin
  tags: ['icons']

- name: Set icon for jamin
  lineinfile:
    path: "/usr/share/applications/jamin.desktop"
    regexp: "^Icon="
    line: Icon=jamin
  tags: ['icons']

- name: Install desktop entries
  synchronize:
    src: "usr/local/share/applications/"
    dest: "/usr/local/share/applications/"
    recursive: yes
    mode: push
    delete: no
    rsync_opts: "--update"
  tags: ['icons']

- name: Copy backgrounds to /usr/share/backgrounds
  synchronize:
    src: "usr/share/backgrounds/"
    dest: "/usr/share/backgrounds/"
    recursive: yes
    mode: push
    delete: no
    rsync_opts: "--update"
  tags: ['wallpaper']

- name: Copy icons to /usr/share/pixmaps
  copy:
    src: usr/share/pixmaps/
    dest: /usr/share/pixmaps/
    directory_mode: yes
    owner: root
    group: root
    mode: '644'
  tags: ['icons']

- name: Update the icon cache
  command: bash -lc "gtk-update-icon-cache"
  register: icon_cache
  changed_when: icon_cache.rc !=0
  tags: ['icons']

- block:
    - name: Ensure these directories exist
      file:
        path: "{{ item }}"
        state: directory
        mode: '0755'
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
      with_items:
        - "{{ user.home }}/.config/gtk-2.0"
        - "{{ user.home }}/.config/gtk-3.0"
        - "{{ user.home }}/.config/gtk-4.0"
        - "{{ user.home }}/.config/qt5ct"
        - "{{ user.home }}/.config/Kvantum"
        - "{{ user.home }}/.config/nitrogen"
        - "{{ user.home }}/.config/zim"
        - "{{ user.home }}/.themes"
        - "{{ user.home }}/.icons"

    - name: Update gtk2
      template:
        src: "dots/gtkrc-2.0.j2"
        dest: "{{ user.home }}/.gtkrc-2.0"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '0644'
        backup: no

    - name: Update gtk3
      template:
        src: "dots/config/gtk-3.0/{{ item }}.j2"
        dest: "{{ user.home }}/.config/gtk-3.0/{{ item }}"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '0644'
        backup: no
      with_items:
        - settings.ini
        - gtk.css

    - name: Update gtk4
      template:
        src: "dots/config/gtk-4.0/settings.ini.j2"
        dest: "{{ user.home }}/.config/gtk-4.0/settings.ini"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '644'
        backup: no

    - name: Update qt5
      template:
        src: "dots/config/qt5ct/qt5ct.conf.j2"
        dest: "{{ user.home }}/.config/qt5ct/qt5ct.conf"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '644'
        backup: no

    - name: Update kvantum
      template:
        src: "dots/config/Kvantum/kvantum.kvconfig.j2"
        dest: "{{ user.home }}/.config/Kvantum/kvantum.kvconfig"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '644'
        backup: no

    - name: Push zim style config
      template:
        src: "dots/config/zim/{{ item }}.j2"
        dest: "{{ user.home }}/.config/zim/{{ item }}"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '0644'
        backup: no
      with_items:
        - "style.conf"
      tags: ['zim']

    - name: Update Xresources
      template:
        src: "dots/Xresources.j2"
        dest: "{{ user.home }}/.Xresources"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '644'
        backup: no


  become: True
  become_user: "{{ user.name }}"
  tags: ['dots']


- block:
    - name: Extract soundbot theme into /home/user/.themes
      unarchive:
        src: oomox-steve_the_robot.tar.gz
        dest: "{{ user.home }}/.themes"

    - name: Extract soundbot theme icons into /home/user/.icons
      unarchive:
        src: oomox-steve_the_robot_icons.tar.gz
        dest: "{{ user.home }}/.icons"

  become: true
  become_user: "{{ user.name }}"
  tags: ['theme']

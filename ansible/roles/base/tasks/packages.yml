---

- name: Set base packages to installl
  set_fact:
    _packages: "{{ (base.system + docker) }}"

- name: remove some packages
  shell: |
    yay -Rdd --noconfirm {{ item }}
  with_items:
    - nodejs
    - erlang-nox
    - pipewire-media-session
  become: True
  become_user: "{{ user.name }}"
  ignore_errors: True

- name: Install base packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present

- name: Set audio packages to install
  set_fact:
    _packages: "{{ (audio.utils + audio.plugins + audio.applications) }}"

- name: Install audio packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present

- block:
    - name: set ui packages to install
      set_fact:
        _packages: "{{ (ui.i3 + ui.x11 + ui.fonts) }}"

    - name: Install ui packages
      import_role:
        name: pkg_manager
      vars:
        pkg_state: present

    - name: set desktop packages to install
      set_fact:
        _packages: "{{ desktop }}"

    - name: Install deskop packages
      import_role:
        name: pkg_manager
      vars:
        pkg_state: present

    - include: desktop/atom.yml

  when: graphical_target|bool
  tags: ['packages', 'desktop']

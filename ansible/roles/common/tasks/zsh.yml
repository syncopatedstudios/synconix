---

- name: Update user shell defined in group_vars/all
  user:
    name: "{{ item }}"
    shell: /bin/zsh
  with_items:
    - root
    - "{{ user.name }}"
  tags: ['zsh']

- name: Check if oh-my-zsh is already installed
  stat: path="/usr/share/oh-my-zsh"
  register: haziohymyzsh
  tags: ['ohmyzsh']

- name: Clone oh-my-zsh
  git:
    repo: "https://github.com/ohmyzsh/ohmyzsh.git"
    dest: "{{ local_src }}/ohmyzsh"
    accept_hostkey: yes
    update: no
    force: no

- name: Install oh-my-zsh
  shell: |
    export ZSH="/usr/share/oh-my-zsh" && \
    sh -c './install.sh --unattended'
  args:
    chdir: "{{ local_src }}/ohmyzsh/tools/"
  when: not haziohymyzsh.stat.exists
  tags: ['ohmyzsh']

- name: Push base dots to /root
  synchronize:
    src: "etc/skel/{{ item }}"
    dest: "/root/"
    recursive: yes
    mode: push
    delete: no
    checksum: yes
    perms: yes
    rsync_opts: "--update"
  with_items:
    - ".zsh"
    - ".zshrc"
    - ".zshenv"
    - ".aliases"
    - ".Xdefaults"
    - ".xprofile"
    - ".profile"
    - ".config/terminator/config"
  tags: ['dots', 'base_root']

---

- name: set packages to install
  set_fact:
    _rtkernel: "{{ kernel|difference(installed_packages) }}"

- name: install rt-kernel
  shell: "{{ ansible_pkg_mgr }} -y install {{ _rtkernel | join(' ') }}"
  when: _rtkernel | length > 0
  register: rtkernel
  tags: ['rtkernel']

- name: Reboot if a different kernel was installed
  shell: shutdown -r now
  when: rtkernel.changed

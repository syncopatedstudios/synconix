---

- name: gather facts
  setup:
    gather_subset:
      - os_family
      - pkg_mgr

- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- include: sudoers.yml
  tags: ['sudoers']

- include: filesystem.yml
  tags: ['filesystem']

- include: rtkernel.yml
  when: kernel is defined
  tags: ['rtkernel']

- include: soundservices.yml
  tags: ['audio', 'alsa', 'jack', 'pulseaudio', pipewire]

- name: Set base packages to install
  set_fact:
    _packages: "{{ base }}"
  tags: ['packages']

- name: Install base packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present

- include: realtime.yml
  tags: ['realtime']

- include: perms.yml
  tags: ['perms']

- include: autofs.yml
  when: autofs_client is defined
  tags: ['autofs']

- include: nfs.yml
  when: nfs_host|bool
  tags: ['nfs']

- include: timeshift.yml
  when: install_timeshift|bool
  tags: ['timeshift']

- include: zsh.yml
  tags: ['zsh']

- include: nvim.yml
  when: install_nvim|bool
  tags: ['nvim']

- include: ripgrep.yml
  when: install_rga|bool
  tags: ['ripgrep']

- include: googler.yml
  when: install_googler|bool
  tags: ['googler']

- include: atom.yml
  when: install_atom|bool
  tags: ['atom']

- include: chrome.yml
  when: install_chrome|bool
  tags: ['chrome']

- include: tui_utils.yml
  when: install_audio_utilities|bool
  tags: ['audio']

- include: gui_utils.yml
  when: install_audio_gutilities|bool
  tags: ['audio']

- include: plugins.yml
  when: install_audio_plugins|bool
  tags: ['audio']

---

- name: Load common install vars
  include_vars: "/opt/soundbot/ansible/roles/distro/{{ ansible_distribution|lower }}/defaults/main.yml"

- name: Install i3 Window Manager
  shell: |
    {{ ansible_pkg_mgr }} -y install {{ i3 | join(' ') }}
  when: item not in installed_packages
  with_items: "{{ i3 }}"

- name: check if swallow is already installed
  stat: path="/usr/local/bin/swallow"
  register: haziswallow

- name: clone i3-swallow
  git:
    repo: "{{ swallow['git'] }}"
    dest: "{{ local_src }}/swallow"
    accept_hostkey: yes
    update: no
    force: no
  when: not haziswallow.stat.exists

- name: move i3-swallow to bin dir
  shell: cp swallow /usr/local/bin/swallow
  args:
    chdir: "{{ local_src }}/swallow"
  when: not haziswallow.stat.exists

- name: Ensure i3 config directory exists
  file:
    path: "{{ user.home }}/.config/i3"
    state: directory
    mode: '0755'
    owner: "{{ user.name }}"
    group: "{{ user.group }}"
  become: True
  become_user: "{{ user.home }}"

- name: push i3 config
  template:
    src: config/i3/config.j2
    dest: "{{ user.home }}/.config/i3/config"
    owner: "{{ user.name }}"
    group: "{{ user.group }}"
    mode: "0644"
    backup: no
  become: True
  become_user: "{{ user.name }}"

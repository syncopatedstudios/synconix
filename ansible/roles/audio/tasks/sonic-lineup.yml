---

- name: check if SonicLineup is already installed
  stat: path="/usr/local/bin/sonic-lineup"
  register: hazisoniclineup

- block:
    - name: fetch SonicLineup
      get_url:
        url: "{{ SonicLineup.url }}{{ SonicLineup.file }}"
        dest: "{{ local_src }}"
        validate_certs: no

  become: True
  become_user: "{{ user.name }}"
  when: not hazisoniclineup.stat.exists

- name: link SonicLineup to bin
  shell: |
    chmod +x {{ SonicLineup.file }}
    ln -s {{ local_src }}/{{ SonicLineup.file }} /usr/local/bin/sonic-lineup
  args:
    chdir: "{{ local_src }}"
  when: not hazisoniclineup.stat.exists

- name: install sonic lineup desktop entry
  copy:
    src: usr/local/share/applications/sonic-lineup.desktop
    dest: /usr/local/share/applications/sonic-lineup.desktop
    directory_mode: no
    mode: '644'
  notify: "update desktop database"

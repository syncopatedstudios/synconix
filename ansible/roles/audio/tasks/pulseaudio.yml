---

- name: remove alsa-plugins-pulseaudio
  shell: "{{ ansible_pkg_mgr }} -y remove alsa-plugins-pulseaudio"
  when: "'alsa-plugins-pulseaudio' in installed_packages"
  tags: ['packages']

- name: Remove pulseaudio systemd configs
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /usr/lib/systemd/user/pulseaudio.service
    - /usr/lib/systemd/user/pulseaudio.socket

- block:
    - name: ensure pulseaudio config directory exists
      shell: "mkdir -pv {{ user.home }}/.config/pulse"

    - name: ensure pulseaudio configs are placed in ~/.config/pulse
      copy:
        src: "config/pulse/{{ item }}"
        dest: "{{ user.home }}/.config/pulse/{{ item }}"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '0644'
        backup: yes
        directory_mode: no
      with_items:
        - client.conf
        - daemon.conf
        - default.pa

  become: True
  become_user: "{{ user.name }}"

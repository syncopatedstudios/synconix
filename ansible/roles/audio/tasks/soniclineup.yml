---

- name: Check if SonicLineup is already installed
  stat: path="/usr/local/bin/sonic-lineup"
  register: hazisoniclineup

- block:
    - block:
        - name: Fetch SonicLineup
          get_url:
            url: "{{ soniclineup.url }}{{ soniclineup.file }}"
            dest: "{{ local_src }}"
            validate_certs: no

      become: True
      become_user: "{{ user.name }}"

    - name: Link soniclineup to bin
      shell: |
        chmod +x {{ soniclineup.file }}
        ln -s {{ local_src }}/{{ soniclineup.file }} /usr/local/bin/sonic-lineup
      args:
        chdir: "{{ local_src }}"

    - name: Copy sonic lineup desktop entry
      copy:
        src: usr/local/share/applications/sonic-lineup.desktop
        dest: /usr/local/share/applications/sonic-lineup.desktop
        directory_mode: no
        mode: '644'
      notify: "update desktop database"

  when: not hazisoniclineup.stat.exists

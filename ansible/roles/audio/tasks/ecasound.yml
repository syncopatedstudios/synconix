---

- name: set ecasound packages to install
  set_fact:
    _dev_ecasound: "{{ development['ecasound'] | difference(installed_packages) }}"
  tags: ['packages']

- name: install ecasound
  shell: "{{ ansible_pkg_mgr }} -y install {{ _dev_ecasound | join(' ') }}"
  when: _dev_ecasound | length > 0
  tags: ['packages']

- name: fetch ecasound
  get_url:
    url: "{{ ecasound.url }}{{ ecasound.file }}"
    dest: "{{ local_src }}"
    validate_certs: no
  become: True
  become_user: "{{ user.name }}"
  tags: ['ecasound']

- name: extract ecasound
  shell: |
    tar -xvf {{ ecasound.file }}

    cd ecasound-2.9.3/

    LIBLILV_CFLAGS=`pkg-config --cflags lilv-0` LIBLILV_LIBS=`pkg-config\n--libs lilv-0` ./configure

    gmake

  args:
    chdir: "{{ local_src }}"
  become: True
  become_user: "{{ user.name }}"
  tags: ['ecasound']

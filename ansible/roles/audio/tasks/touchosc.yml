---

- name: check if TouchOSC is already installed
  stat: path="/usr/local/bin/TouchOSC"
  register: haziTouchOSC
  tags: ['TouchOSC']

- block:
    - name: fetch TouchOSC
      get_url:
        url: "{{ touchosc.url }}/{{ touchosc.file }}"
        dest: "{{ local_src }}"
      tags: ['TouchOSC']

    - name: extract and install TouchOSC
      shell: |
        unzip {{ touchosc.file }}
        mv TouchOSC /usr/local/bin/TouchOSC
      args:
        chdir: "{{ local_src }}"

  become: True
  become_user: "{{ user.name }}"
  when: not haziTouchOSC.stat.exists

- name: install TouchOSC desktop entry
  copy:
    src: usr/local/share/applications/TouchOSC.desktop
    dest: /usr/local/share/applications/TouchOSC.desktop
    directory_mode: no
    mode: '644'
  tags: ['TouchOSC']
  notify: "update desktop database"

- name: check if Protokol is already installed
  stat: path="/usr/local/bin/Protokol"
  register: haziProtokol
  tags: ['TouchOSC']

- block:
    - name: fetch Protokol
      get_url:
        url: "{{ protokol.url }}/{{ protokol.file }}"
        dest: "{{ local_src }}"
      tags: ['Protokol']

    - name: extract and install Protokol
      shell: |
        unzip {{ protokol.file }}
        mv Protokol /usr/local/bin/Protokol
      args:
        chdir: "{{ local_src }}"

  become: True
  become_user: "{{ user.name }}"
  when: not haziProtokol.stat.exists

- name: install Protokol desktop entry
  copy:
    src: usr/local/share/applications/Protokol.desktop
    dest: /usr/local/share/applications/Protokol.desktop
    directory_mode: no
    owner: root
    group: root
    mode: '644'
  tags: ['Protokol']
  notify: "update desktop database"

- name: enable avahi service
  systemd:
    name: avahi-daemon
    enabled: yes
  tags: ['TouchOSC', 'Protokol']

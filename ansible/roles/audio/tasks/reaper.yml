---

- name: check if reaper is already installed
  stat: path="/usr/local/bin/reaper"
  register: hazireaper
  tags: ['reaper']

- block:
    - name: ensure desktop-directories directory exists
      file:
        path: "/usr/share/desktop-directories"
        state: directory
        owner: root
        group: root
        mode: '0775'
      tags: ['reaper']

    - name: fetch reaper
      get_url:
        url: "{{ reaper.url }}{{ reaper.file }}"
        dest: "{{ local_src }}"
        # validate_certs: no

    - name: extract reaper
      shell: |
        tar -xvf {{ reaper.file }}

        cd reaper_linux_x86_64/

        ./install-reaper.sh --install /opt --integrate-desktop --usr-local-bin-symlink
      args:
        chdir: "{{ local_src }}"
  become: True
  become_user: "{{ user.name }}"
  when: hazireaper.stat.exists

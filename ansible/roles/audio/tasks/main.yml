---

- name: Load common install vars
  include_vars: "/opt/soundbot/ansible/roles/distro/{{ ansible_distribution|lower }}/defaults/main.yml"

- name: push jack limits file
  copy:
    src: etc/security/limits.conf
    dest: /etc/security/limits.conf
    owner: root
    group: root
    mode: '0644'
  tags: ['tuning']

- include: pipewire.yml
  when: remove_pipewire|bool

- name: install makesfz and makeh2drumkit
  copy:
    src: "usr/local/bin/{{ item }}"
    dest: "/usr/local/bin/{{ item }}"
    owner: root
    group: root
    mode: '0755'
  with_items:
    - makeh2kit
    - makesfz
  tags: ['soundfonts']

- name: install audio utilities
  shell: "{{ ansible_pkg_mgr }} -y install {{ audio['utilities'] | join(' ') }}"
  when: item not in installed_packages and utilities|bool
  with_items:
    - "{{ audio.utilities }}"

- name: install plugins
  shell: "{{ ansible_pkg_mgr }} -y install {{ audio.plugins | join(' ') }}"
  when: item not in installed_packages and plugins|bool
  with_items: "{{ audio.plugins }}"

- name: install polyphone
  shell: "{{ ansible_pkg_mgr }} -y install polyphone"
  tags: ['polyphone']
  when: polyphone|bool

- include: njconnect.yml
  tags: ['njconnect']
  when: njconnect|bool

- include: qmidinet.yml
  tags: ['qmidinet']
  when: qmidinet.install|bool

- include: sonic-pi.yml
  tags: ['sonicpi']
  when: SonicPi.install|bool

- include: sonic-pi-tool.yml
  tags: ['sonicpitool']
  when: SonicPi.install|bool

- include: reaper.yml
  tags: ['reaper']
  when: reaper.install|bool

- include: tony.yml
  when: Tony.install|bool

- include: sonic-lineup.yml
  when: SonicLineup.install|bool

- include: touchosc.yml
  tags: ['TouchOSC']

- include: raysession.yml
  tags: ['raysession']

- include: jalvselect.yml
  tags: ['jalvselect']

- include: obs-studio.yml
  tags: ['obs']

- include: baudline.yml
  tags: ['baudline']
  when: Baudline.install|bool

- name: check if ocenaudio is already installed
  stat: path="/usr/bin/ocenaudio"
  register: haziocenaudio
  tags: ['ocenaudio']

- include: ocenaudio.yml
  tags: ['ocenaudio']
  when: not haziocenaudio.stat.exists and ocenaudio.install|bool

# - include: rtplugins.yml
#   when: rtplugins.install|bool

# - include: ardour.yml
#   tags: ['ardour', 'daw']
#   when: ardour.install|bool

# - include: deadbeef.yml
#   tags: ['deadbeef']
#   when: deadbeef|bool

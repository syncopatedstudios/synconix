---

- name: check if sonicpitool is already installed
  stat: path="/usr/local/bin/sonicpi-tool"
  register: hazisonicpitool
  tags: ['sonicpitool']

- block:
    - name: Install sonicpi-tools dependencies
      pip:
        name: "{{ sonicpitool['pip'] }}"
        extra_args: --user

    - name: fetch sonicpi-tool
      get_url:
        url: "{{ sonicpitool['url'] }}"
        dest: "{{ local_src }}"
        # validate_certs: no

    - name: mark executable and copy to /usr/local/bin
      shell: |
        chmod +x sonicpi-tool.py
        cp sonicpi-tool.py /usr/local/bin/sonicpi-tool
      args:
        chdir: "{{ local_src }}"
  become: True
  become_user: "{{ user.name }}"
  when: not hazisonicpitool.stat.exists

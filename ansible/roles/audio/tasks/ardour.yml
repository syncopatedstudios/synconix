---

- name: set packages to install
  set_fact:
    _dev_ardour: "{{ development['ardour']|difference(installed_packages) }}"
  tags: ['packages']

- name: install ardour deps
  shell: "{{ ansible_pkg_mgr }} -y install {{ _dev_ardour | join(' ') }}"
  when: _dev_ardour | length > 0
  tags: ['packages']

- name: build ardour
  shell: |
    git clone {{ ardour.url }}

    cd ardour/

    ./waf configure --denormal-exception --no-phone-home --canvasui \
    --freedesktop --optimize --thread-sanitizer --docs

    ./waf

    ./waf install && ./waf clean

  args:
    chdir: "{{ local_src }}"

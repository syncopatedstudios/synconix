---

- name: check if njconnect is already installed
  stat: path="/usr/bin/njconnect"
  register: hazinjconnect

- name: set packages to install
  set_fact:
    _dev_njconnect: "{{ development['njconnect'] | difference(installed_packages) }}"
  tags: ['packages']

- name: install njconnect deps
  shell: "{{ ansible_pkg_mgr }} -y install {{ _dev_njconnect | join(' ') }}"
  when: _dev_njconnect | length > 0
  tags: ['packages']

- block:
  - name: clone njconnect
    git:
      repo: "https://github.com/radiganm/njconnect.git"
      dest: "{{ local_src }}/njconnect"
      accept_hostkey: yes
      update: no
      force: no

  - name: make and install njconnect
    shell: |
      make
      sleep 0.5
      sudo make install
    args:
      chdir: "{{ local_src }}/njconnect"

  become: True
  become_user: "{{ user.name }}"
  when: not hazinjconnect.stat.exists

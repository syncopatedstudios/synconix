---

- name: check if njconnect is already installed
  stat: path="/usr/bin/njconnect"
  register: hazinjconnect

- block:
    - name: set packages to install
      set_fact:
        _packages: "{{ development.njconnect | join(',') }}"
      tags: ['packages']

    - name: Ensure all the required packages are installed
      import_role:
        name: pkg_manager
      vars:
        pkg_state: present
      tags: ['packages']

    - block:
      - name: clone njconnect
        git:
          repo: "{{ njconnect['git'] }}"
          dest: "{{ local_src }}/njconnect"
          accept_hostkey: yes
          update: no
          force: no

      - name: make and install njconnect
        shell: |
          make
          sleep 0.5
          sudo make install
        args:
          chdir: "{{ local_src }}/njconnect"
        register: njconnect_build
        failed_when: njconnect_build.failed

      become: True
      become_user: "{{ user.name }}"


  when: not hazinjconnect.stat.exists

---

- name: check if jacktrip is already installed
  stat: path="/usr/local/bin/jacktrip"
  register: hazijacktrip
  tags: ['jacktrip']

- block:
  - name: clone jacktrip
    git:
      repo: "{{ jacktrip['git'] }}"
      dest: "{{ local_src }}/jacktrip"
      accept_hostkey: yes
      update: no
      force: no

  - name: build jacktrip
    shell: |
      cd src
      ./build
      cd ../builddir
      mv jacktrip /usr/local/bin/jacktrip
    args:
      chdir: "{{ local_src }}/jacktrip"
    register: jacktrip
    failed_when: jacktrip.failed

  become: True
  become_user: "{{ user.name }}"
  when: not hazijacktrip.stat.exists

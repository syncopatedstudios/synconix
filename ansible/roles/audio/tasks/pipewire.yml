---

- block:
    - name: Remove pipewire
      dnf:
        name: "{{ pipewire }}"
        state: absent
      tags: ['pipewire']

    - name: Install alsa
      dnf:
        name: "{{ alsa }}"
        state: present
      when: item not in installed_packages
      with_items: "{{ alsa }}"
      tags: ['alsa']

    - name: Install jack
      dnf:
        name: "{{ jack }}"
        state: present
      when: item not in installed_packages
      with_items: "{{ jack }}"
      tags: ['jack']

    - name: Install pulseaudio
      dnf:
        name: "{{ pulseaudio }}"
        state: present
      when: item not in installed_packages
      with_items: "{{ pulseaudio }}"
      tags: ['pulseaudio']

    - name: Ensure pulseaudio-alsa is not installed
      dnf:
        name: alsa-plugins-pulseaudio
        state: absent
      tags: ['pulseaudio']

    - name: Remove pulseaudio systemd configs
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - /usr/lib/systemd/user/pulseaudio.service
        - /usr/lib/systemd/user/pulseaudio.socket

  when: ansible_os_family == 'RedHat'

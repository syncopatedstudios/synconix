---

- name: check if .dots already exists
  stat: path="{{ user.home }}/.dots"
  register: hazidots
  tags: ['dots']

- block:
    - name: push dots installer
      template:
        src: dots_installer.j2
        dest: "{{ user.home }}/dots_installer.rb"
        owner: "{{ user.name}}"
        group: "{{ user.name}}"
        mode: '755'
        backup: yes
      tags: ['dots']

    - name: run dots installer
      shell: |
        ruby initialize_dots.rb
      args:
        chdir: "{{ user.home }}"

  become: True
  become_user: "{{ user.name }}"
  when: not hazidots.stat.exists
  tags: ['dots']

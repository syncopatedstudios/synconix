---

- include: soundcard.yml
  tags: ['soundcard']

- include: annotator.yml
  tags: ['sonic-annotator']

- include: audiowaveform.yml
  tags: ['audiowaveform']

- name: ensure opt perms
  file:
    path: "/opt"
    state: directory
    mode: '2775'
    group: "{{ user.group }}"

- block:
    - name: clone soundbot
      git:
        repo: "https://gitlab.com/syncopatedstudios/soundbot.git"
        dest: "/opt/soundbot"
        accept_hostkey: yes
        update: no
        force: no

    - name: run bundle install
      command: bundle install && sudo gem pristine --all
      args:
        chdir: /opt/soundbot
      become: True
      become_user: "{{ user.name }}"


  become: true
  become_user: "{{ user.name }}"

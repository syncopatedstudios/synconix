---

- name: set the package manager variable
  set_fact:
    __ansible_pkg_mgr: "sudo pamac install --no-confirm --no-upgrade"
  tags: ['packages']

- name: set the package manager variable
  set_fact:
    __ansible_pkg_mgr_remove: "sudo pamac remove --no-confirm --no-upgrade"
  tags: ['packages']

- name: push pacman conf
  template:
    src: etc/pacman.conf.j2
    dest: /etc/pacman.conf
    mode: '0644'
    owner: root
    group: root
    backup: yes
  tags: ['pacmanconf']

- name: copy pacman mirrors config
  copy:
    src: etc/pacman.d/mirrorlist
    dest: /etc/pacman.d/mirrorlist
    owner: root
    group: root
    mode: '0644'
    directory_mode: no
    backup: yes
  tags: ['pacmanconf']

- name: install other mirror update thing
  pacman:
    name: pacman-mirrors
    state: present
  tags: ['mirrors']

- name: update manjaro mirrors
  shell: pacman-mirrors -f 5
  when: update_mirrors|bool
  tags: ['mirrors']

- name: Update system package cache
  pacman:
    update_cache: yes
    upgrade: yes
  register: update_result
  tags: ['update']

# - name: install pamac
#   shell: |
#     yay -S --noconfirm --needed --cleanafter pamac
#   become: True
#   become_user: "{{ user.name }}"
#   tags: ['pamac']
#

- name: remove packages
  pacman:
    name: "{{ remove }}"
    state: absent
    force: yes
    extra_args: --noconfirm
  tags: ['remove']

---

- name: Set font packages to install
  set_fact:
    _packages: "{{ ui.fonts }}"
  tags: ['packages']

- name: Install font packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present
  tags: ['packages']

- name: check if locat fonts exists
  stat: path="/usr/local/share/fonts/Feather.ttf"
  register: hazilocalfonts

- name: Extract fonts to /usr/local/share/fonts
  unarchive:
    src: usr/local/share/fonts.tar.gz
    dest: "/usr/local/share/"
  when: not hazilocalfonts.stat.exists

- block:
    - name: Ensure fontconfig dir exists
      file:
        path: "{{ user.home}}/.config/fontconfig"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        state: directory
        mode: '755'

    - name: update fontconfig
      template:
        src: fontconfig/fonts.conf.j2
        dest: "{{ user.home }}/.config/fontconfig/fonts.conf"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: '644'
        backup: no

    # if this isn't done then baudline won't load
    - name: add x11 fonts to font paths
      shell: |
        xset +fp /usr/share/fonts/75dpi
        xset +fp /usr/share/fonts/100dpi


  become: True
  become_user: "{{ user.name }}"

#TODO: xset:  unable to open display
#- name: add x11 fonts to font paths
#  shell: |
#    xset +fp /usr/share/fonts/75dpi
#    xset +fp /usr/share/fonts/100dpi
#  tags: ['fonts']

- name: Update font-cache
  command: fc-cache -r

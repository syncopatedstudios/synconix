---

- name: gather facts
  setup:
    gather_subset:
      - os_family
      - pkg_mgr

- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- name: set packages to install
  set_fact:
    _packages: "{{ ui.utilities }}"
  tags: ['packages']

- name: Ensure all the required packages are installed
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present
  tags: ['packages']

- name: copy help file to ~/.config/conky_help
  copy:
    src: conky_help
    dest: "{{ user.home }}/.config/conky_help"
    owner: "{{ user.name }}"
    group: "{{ user.group }}"
    mode: '0644'
    backup: yes
    directory_mode: no
  tags: ['help']

- include: environment.yml
  tags: ['env', 'xorg', 'zsh']

- include: x11.yml
  when: install_x11|bool
  tags: ['x11']

- include: i3.yml
  when: install_i3|bool
  tags: ['i3']

- include: autologin.yml
  when: autologin|bool
  tags: ['autologin']

- include: theme.yml
  tags: ['theme']

- name: set graphical-target as default
  shell: |
    systemctl set-default graphical.target
  when: graphical_target|bool

- name: set packages to install
  set_fact:
    _packages: "{{ ui.desktop }}"
  tags: ['packages']

- name: Ensure all the required packages are installed
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present
  when: install_desktop|bool
  tags: ['packages']

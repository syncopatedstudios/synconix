---

- name: Ensure sonic-pi config directory exists
  file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
    owner: "{{ user.name }}"
    group: "{{ user.group }}"
  with_items:
    - "{{ user.home }}/.sonic-pi"
    - "{{ user.home }}/.sonic-pi/config"

- name: Push sonic-pi helpers and snippets
  synchronize:
    src: "dots/sonic-pi/"
    dest: "{{ user.home }}/.sonic-pi/"
    recursive: yes
    mode: push
    delete: no
    rsync_opts: "--update"

- name: Push sonic-pi gui configs
  template:
    src: "dots/sonic-pi/config/{{ item }}.j2"
    dest: "{{ user.home }}/.sonic-pi/config/{{ item }}"
    owner: "{{ user.name }}"
    group: "{{ user.group }}"
    mode: '0644'
    backup: no
  with_items:
    - audio-settings.toml
    - colour-theme.properties
    - init.rb

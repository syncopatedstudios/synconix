---

# - name: gather facts
#   setup:
#     gather_subset:
#       - os_family
#       - pkg_mgr

- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- include: pulseaudio.yml
  tags: ['pulseaudio']

- name: set alsa packages to install
  set_fact:
    _packages: "{{ alsa }}"
  tags: ['packages']

- name: install alsa packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present
  tags: ['packages']

- include: alsa.yml
  tags: ['alsa']

- name: set pipewire packages to install
  set_fact:
    _packages: "{{ pipewire }}"
  tags: ['packages']

- name: install pipewire packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present
  when: "ansible_os_family == 'Archlinux'"
  tags: ['packages']

- include: pipewire.yml
  tags: ['pipewire']

#-------------------------------------#
- name: Set audio packages to install
  set_fact:
    _packages: "{{ audio }}"
  tags: ['packages']

- name: Install audio packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present

- block:
    - name: Set daw packages to install
      set_fact:
        _packages: "{{ daw }}"
      tags: ['packages']

    - name: Install daw packages
      import_role:
        name: pkg_manager
      vars:
        pkg_state: present

  when: install_daw|bool
  tags: ['audio','daw']

- block:
    - name: set graphical audio utility packages to
      set_fact:
        _packages: "{{ utilities }}"
      tags: ['packages']

    - name: Install audio utilities
      import_role:
        name: pkg_manager
      vars:
        pkg_state: present
      tags: ['packages']

  when: install_audio_utils|bool
  tags: ['audio','utils']

- block:
    - name: set audio plugins packages to
      set_fact:
        _packages: "{{ plugins }}"
      tags: ['packages']

    - name: Install audio plugins
      import_role:
        name: pkg_manager
      vars:
        pkg_state: present
      tags: ['packages']

  when: install_audio_plugins|bool
  tags: ['audio', 'plugins']

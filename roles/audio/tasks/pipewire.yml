---

- block:
    - name: ensure pipewire config directory exists
      shell: "mkdir -pv {{ user.home }}/.config/pipewire"

    - name: Push pipewire configs
      synchronize:
        src: "dots/config/pipewire/"
        dest: "{{ user.home }}/.config/pipewire/"
        recursive: yes
        mode: push
        delete: no
        checksum: yes
        perms: no
        rsync_opts: "--update"
      tags: ['pipewire']

    - name: enable pipewire services
      systemd:
        name: pipewire
        state: reloaded
        scope: user

    # - name: enable wireplumber services
    #   systemd:
    #     name: wireplumber
    #     state: restarted
    #     scope: user

  become: True
  become_user: "{{ user.name }}"


# - name: remove pipewire
#   shell: |
#     pamac remove --no-confirm --no-upgrade {{ item }}
#   with_items:
#     - "{{ _packages }}"
#   when: "ansible_os_family == 'Archlinux'"
#   tags: ['packages']

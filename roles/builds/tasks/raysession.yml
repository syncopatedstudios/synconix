---

- name: check if raysession is already installed
  stat: path="/usr/local/bin/raysession"
  register: haziraysession
  tags: ['raysession']

- name: set raysession dependencies to install
  set_fact:
    _packages: "{{ builds.raysession }}"
  when: development.raysession is defined
  tags: ['packages']

- name: Install raysession dependencies
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present
  tags: ['packages']

- block:
    - block:
      - name: clone raysession
        git:
          repo: "{{ raysession['git'] }}"
          dest: "{{ local_src }}/RaySession"
          accept_hostkey: yes
          update: no
          force: no

      - name: make and install ray session
        shell: |
          make
          sleep 0.5
          sudo make install
        args:
          chdir: "{{ local_src }}/RaySession"
        register: raysession_build
        failed_when: raysession_build.failed

      become: True
      become_user: "{{ user.name }}"

  when: not haziraysession.stat.exists

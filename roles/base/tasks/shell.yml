---

- name: gather facts
  setup:
    gather_subset:
      - os_family
      - pkg_mgr

- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- block:
    - name: Push zshell templates
      template:
        src: "dots/{{ item }}.j2"
        dest: "{{ user.home }}/.{{ item }}"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: "0644"
        backup: yes
      with_items:
        - "aliases"
        - "gitconfig"
        - "zlogin"
        - "zshenv"
        - "zshrc"

    - name: Push zshell function folder
      synchronize:
        src: dots/zsh/
        dest: "{{ user.home }}/.zsh/"
        recursive: yes
        mode: push
        delete: no
        checksum: yes
        perms: no
        rsync_opts: "--update"

    # - name: Install kitti3
    #   pip:
    #     name: kitti3
    #     extra_args: --user
    #   tags: ['kitty']

    - name: install termpdf
      shell: |
        git clone https://github.com/dsanson/termpdf.py
        cd termpdf.py
        pip install -r requirements.txt
        sudo cp termpdf.py /usr/local/bin/termpdf.py
      args:
        chdir: "{{ local_src }}"
      tags: ['kitty']

    - name: Push terminal emulator configs
      synchronize:
        src: "dots/config/{{ item }}"
        dest: "{{ user.home }}/.config/"
        recursive: yes
        mode: push
        delete: no
        checksum: yes
        perms: no
        rsync_opts: "--update"
      with_items:
        - kitty
        - terminator
      tags: ['terminator', 'kitty']

  become: True
  become_user: "{{ user.name }}"
  tags: ['ui', 'shell']

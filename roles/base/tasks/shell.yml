---

- name: gather facts
  setup:
    gather_subset:
      - os_family
      - pkg_mgr

- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- block:
    - name: Push zshell templates
      template:
        src: "dots/{{ item }}.j2"
        dest: "{{ user.home }}/.{{ item }}"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: "0644"
        backup: yes
      with_items:
        - "aliases"
        - "gitconfig"
        - "zlogin"
        - "zshenv"
        - "zshrc"

    - name: Push zshell function folder
      synchronize:
        src: dots/zsh/
        dest: "{{ user.home }}/.zsh/"
        recursive: yes
        mode: push
        delete: no
        checksum: yes
        perms: no
        rsync_opts: "--update"

    - name: Install kitti3
      pip:
        name: kitti3
        extra_args: --user
      tags: ['kitty']


    - name: Push kitty configs
      synchronize:
        src: "dots/config/kitty/"
        dest: "{{ user.home }}/.config/kitty/"
        recursive: yes
        mode: push
        delete: no
        checksum: yes
        perms: no
        rsync_opts: "--update"
      tags: ['kitty']

  become: True
  become_user: "{{ user.name }}"
  tags: ['ui']

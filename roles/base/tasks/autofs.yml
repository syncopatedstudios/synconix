---

# - name: check if atom is already installed
#   stat: path="/usr/bin/autofs"
#   register: haziautofs
#   check_mode: no
#
# - block:
#     - name: Set base packages to install
#       set_fact:
#         _packages: autofs
#       tags: ['packages']
#
#     - name: Install autofs
#       import_role:
#         name: pkg_manager
#       vars:
#         pkg_state: present
#
#   when: not haziautofs.stat.exists

- name: Create mount directory folder if it doesn't already exist
  file:
    path: /mnt/{{ autofs_client.host }}
    state: directory
    mode: '0755'

- name: Push autofs configs
  template:
    src: etc/autofs/{{ item }}.j2
    dest: "{{ autofs_configs }}/{{ item }}"
    mode: '0644'
    owner: root
    group: root
    backup: yes
  register: autofsconfig
  with_items:
    - autofs.conf
    - auto.master
    - auto.mnt

- name: Enable and/or start autofs
  systemd: enabled=yes state=restarted daemon_reload=yes name=autofs
  when: autofsconfig.changed

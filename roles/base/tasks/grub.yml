---

- name: gather facts
  setup:
    gather_subset:
      - os_family
      - pkg_mgr

- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- name:  push mkinitcpio configs
  template:
    src: "etc/mkinitcpio.conf.j2"
    dest: "/etc/mkinitcpio.conf"
    owner: root
    group: root
    mode: '644'
    backup: yes
  register: mkinit
  tags: ['initram']

- name: create an initial ramdisk environment.
  shell: |
    mkinitcpio -P
  when: mkinit.changed
  tags: ['initram']

- name: push default grub file
  template:
    src: etc/default/grub.j2
    dest: /etc/default/grub
    owner: root
    group: root
    mode: '644'
    backup: yes
  notify:
    - remake grub
    - reboot

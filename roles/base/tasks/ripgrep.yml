---

- name: check if ripgrep-all is already installed from source
  stat: path="/usr/local/bin/rga"
  register: hazirga_source

- block:
    - name: fetch ripgrep
      get_url:
        url: https://github.com/BurntSushi/ripgrep/releases/download/13.0.0/ripgrep_13.0.0_amd64.deb
        dest: "{{ local_src }}"

    - name: install ripgrep
      shell: |
        apt -y install ./ripgrep_13.0.0_amd64.deb
      args:
        chdir: "{{ local_src }}"

  when:
    - (ansible_os_family == 'Debian' or ansible_os_family == 'Zorin OS')
    - not hazirga_source.stat.exists

- block:
    - name: fetch ripgrep-all
      get_url:
        url: https://github.com/phiresky/ripgrep-all/releases/download/v0.9.6/ripgrep_all-v0.9.6-x86_64-unknown-linux-musl.tar.gz
        dest: "{{ local_src }}"

    - name: install ripgrep-all
      shell: |
        tar -xvf ripgrep_all-v0.9.6-x86_64-unknown-linux-musl.tar.gz
        cd ripgrep_all-v0.9.6-x86_64-unknown-linux-musl/
        mv /usr/local/src/ripgrep_all-v0.9.6-x86_64-unknown-linux-musl/rga /usr/local/bin/rga
        mv /usr/local/src/ripgrep_all-v0.9.6-x86_64-unknown-linux-musl/rga-preproc /usr/local/bin/rga-preproc
      args:
        chdir: "{{ local_src }}"
  when:
    - (ansible_os_family == 'Debian' or ansible_os_family == 'Zorin OS')
    - not hazirga_source.stat.exists

- name: check if ripgrep-all is already installed via pkg manager
  stat: path="/usr/bin/rga"
  register: hazirga

- block:
    - name: install ripgrep-all for arch
      aur:
        use: auto
        name: ripgrep-all
        state: present
      become: True
      become_user: "{{ user.name }}"

  when:
    - ansible_os_family == 'Archlinux'
    - not hazirga.stat.exists

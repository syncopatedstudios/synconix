---

- name: starting base role
  debug:
    msg: "starting base role"

- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- name: Set base packages to install
  set_fact:
    _packages: "{{ base }}"
  tags: ['packages']

- name: Install base packages
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present

- include: firewalld.yml
  tags: ['firewall']

- include: sudoers.yml
  tags: ['sudoers']

- include: zsh.yml
  tags: ['zsh']

- include: shell.yml
  tags: ['shell']

# - include: dots.yml
#   tags: ['dots']

# - include: ruby.yml
#   tags: ['ruby']

- include: filesystem.yml
  tags: ['filesystem']

- include: kernel.yml
  when: use_kernel is defined
  tags: ['kernel']

- include: realtime.yml
  tags: ['realtime']

- include: nfs.yml
  when: nfs_host is defined
  tags: ['nfs']

- include: autofs.yml
  when: autofs_client is defined
  tags: ['autofs']

- include: docker.yml
  when: docker_host|bool and docker is defined
  tags: ['docker']

- include: libvirt.yml
  when: kvm_host|bool and libvirt is defined
  tags: ['libvirt']

- include: backups.yml
  tags: ['backups']

- include: nvim.yml
  tags: ['nvim']

- include: indexer.yml
  tags: ['indexer']

- include: filemanager.yml
  tags: ['filemanager', 'ranger' ,'pcmanfm']

- block:
    - name: Set desktop packages
      set_fact:
        _packages: "{{ (desktop['utilities'] + desktop['applications']) }}"

    - name: Install desktop packages
      import_role:
        name: pkg_manager
      vars:
        pkg_state: present

    - include: atom.yml
      tags: ['atom']

    - include: chrome.yml
      tags: ['chrome']

  when: inventory_hostname in groups['desktops']
  tags: ['packages', 'desktop']

- name: configure audio system
  import_role:
    name: audio
  when: inventory_hostname in groups['desktops']

- name: configure ui
  import_role:
    name: ui
  when: inventory_hostname in groups['desktops']
  tags: ['ui']

- name: build apps
  import_role:
    name: builds
  when: inventory_hostname in groups['desktops']
  tags: ['builds']

---

- name: set packages to install
  set_fact:
    _packages: "{{ docker }}"
  tags: ['packages']

- name: Ensure all the required packages are installed
  import_role:
    name: pkg_manager
  vars:
    pkg_state: present
  tags: ['packages']

- name: add user to dockergroup
  command: bash -lc "usermod -a -G docker {{ user.name }}"

- name: push docker service config
  template:
    src: usr/lib/systemd/docker.service.j2
    dest: /usr/lib/systemd/docker.service
    owner: root
    group: root
    mode: '644'
    backup: yes
  tags: ['docker']
  register: dockerservice

- name: reload systemd
  shell: |
    systemctl daemon-reload
  tags: ['docker']

- name: enable docker service
  systemd:
    name: docker
    state: started
    enabled: yes

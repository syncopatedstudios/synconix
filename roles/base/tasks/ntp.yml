---

- name: permit traffic for ntp service
  firewalld:
    service: ntp
    permanent: yes
    state: enabled
  notify:
    - "reload firewalld"

- name: copy timesyncd config
  copy:
    src: etc/systemd/timesyncd.conf
    dest: /etc/systemd/timesyncd.conf
    owner: root
    group: root
    mode: '0644'
  register: timesync_config

- block:

    - name: reload systemd
      shell: |
        systemctl daemon-reload

    - name: restart systemd-timesyncd.service
      systemd:
        name: systemd-timesyncd.service
        state: restarted
        enabled: yes

  when: timesync_config.changed
